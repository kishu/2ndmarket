<div *ngIf="commentList$ | async as commentList" class="p-3">
  <ng-container [ngSwitch]="commentUserCount">
    <p class="text-blue-900 text-xs opacity-50" *ngSwitchDefault>{{ commentUserCount }}명의 유저가 이 상품에 대한 이야기를 나누고 있습니다.</p>
    <p class="text-blue-900 text-xs opacity-50" *ngSwitchCase="1">1명의 유저가 이 상품에 대한 이야기를 하고 있습니다.</p>
    <p class="text-blue-900 text-xs opacity-50" *ngSwitchCase="0">이 상품에 대한 이야기가 없습니다.</p>
  </ng-container>
  <ul>
    <li
      class="select-none py-1"
      *ngFor="let comment of commentList trackBy:trackById">
      <div
        class="flex -mx-1"
        *ngFor="let talk of comment trackBy:trackById; first as isFirst; last as isLast"
        [ngClass]="{'flex-row-reverse': talk.permission}">
        <ng-container *ngIf="talk.profileId | fsDocument:'profiles' | async as profile">
          <div
            class="w-8 h-8 m-1 bg-white rounded-full flex items-center justify-center text-sm font-bold uppercase"
            [ngClass]="{'opacity-0': !isFirst, 'bg-yellow-400': talk.seller}"
            *ngIf="!talk.permission">{{ profile.displayName.slice(0, 1) }}</div>
          <div
            class="flex flex-col"
            [ngClass]="{'items-end': talk.permission}"
            style="max-width: 75%;">
            <span class="mx-1 text-xs text-white" *ngIf="isFirst">{{ profile.displayName }}{{ talk.seller && !talk.permission ? '(판매자)' : '' }}</span>
            <div
              class="flex mb-1"
              [ngClass]="{'flex-row-reverse': talk.permission}">
              <p
                appLongpress
                class="talk mx-1 shadow max-w-sm break-all whitespace-pre-wrap rounded-xxlg"
                [ngClass]="{
                  'rounded-tl-none': !talk.permission,
                  'rounded-bl-none': !talk.permission && !isLast,
                  'rounded-bl-xlg': !talk.permission && isLast,
                  'rounded-tr-none': talk.permission,
                  'rounded-br-none': talk.permission && !isLast,
                  'rounded-br-xlg': talk.permission && isLast
                }"
                (longpress)="onDelete(talk)">{{ talk.body }}</p>
              <div class="flex flex-shrink-0 items-end">
                <span class="text-xs flex-shrink-0 text-gray-500" *ngIf="isLast">{{ talk.created | fsTimestamp | date:'HH:mm' }}</span>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </li>
  </ul>
</div>
<div class="flex justify-center mb-6" *ngIf="goods.soldOut">
  <p class="px-3 bg-gray-500 text-sm text-gray-200">상품이 팔렸습니다.</p>
</div>
