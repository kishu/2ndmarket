<h2>이메일 인증</h2>

<ng-container *ngIf="(step$ | async) === 'account'">
  <div>
    이메일을 입력하세요.<br>
    입력한 이메일로 인증번호를 보냅니다.
  </div>
  <form
    [formGroup]="accountForm"
    (ngSubmit)="submitAccount()">
    <div>
      <label for="account">이메일 주소</label>
      <input
        type="text"
        id="account"
        name="account"
        formControlName="account"
        required>
      @
      <label for="domain" style="display:none">도메인</label>
      <select
        id="domain"
        name="domain"
        formControlName="domain"
        required>
        <option value="">도메인 선택</option>
        <option *ngFor="let domain of (domains$ | async)" [value]="domain">{{ domain }}</option>
      </select>
    </div>
    <div *ngIf="accountCtl.invalid && (accountCtl.dirty || accountCtl.touched)">
      이메일 계정을 입력하세요.
    </div>
    <div *ngIf="domainCtl.invalid && (domainCtl.dirty || domainCtl.touched)">
      이메일 도메인을 선택하세요.
    </div>
    <div>
      <button
        type="submit"
        [disabled]="submitted || !accountForm.valid">
        {{ submitted ? '보내는 중...' : '이메일 보내기' }}
      </button>
    </div>
  </form>
</ng-container>

<ng-container *ngIf="(step$ | async) === 'verification'">
  <div>
    {{ accountCtl.value }}@{{ domainCtl.value }}(으)로 인증메일을 보냈습니다.<br>
    인증번호를 입력하세요.
  </div>
  <form
    [formGroup]="verificationForm"
    (ngSubmit)="submitVerification()">
    <label for="code">인증번호</label>
    <input
      type="text"
      id="code"
      name="code"
      formControlName="code"
      required>
    <app-limit-timer
      [time]="1000 * 60 * 3"
      (timeover)="onTimeoverLimitTimer()">
    </app-limit-timer>
    <div *ngIf="timeover">
      인증시간이 끝났습니다. 이메일을 다시 보내세요.
    </div>
    <div>
      <button
        type="submit"
        [disabled]="submitted || !verificationForm.valid || timeover">
        인증하기
      </button>
    </div>
  </form>
  <div>
    <button type="button" (click)="retry()">이메일 다시 보내기</button>
  </div>
</ng-container>

<!--<ng-container *ngIf="(step$ | async) === 'verification'">-->
<!--  <div>-->
<!--    {{ accountCtl.value }}@{{ domainCtl.value }}(으)로 인증메일을 보냈습니다.-->
<!--  </div>-->
<!--  <div>-->
<!--    <button type="button" (click)="retry()">이메일 다시 보내기</button>-->
<!--  </div>-->
<!--</ng-container>-->

<!--<ng-container *ngIf="(step$ | async) === 'verified'">-->
<!--  <div>이메일을 인증했습니다. <a [routerLink]="['']">홈으로 이동</a></div>-->
<!--</ng-container>-->
